# JDS6600 Controller (GUI + CLI)

Утилита для управления DDS‑генератором **JDS6600** по USB/Serial, на базе библиотеки `jds6600`.

- **GUI”** (Tkinter): открыть/редактировать файл команд, автопоиск устройства, запуск/пауза/стоп, пропуск ожидания, подсветка текущей строки.
- **CLI**: удобно для автоматизации/скриптов.
- **Windows**: собирается в portable **.exe** (без установки Python у пользователя).
- **Linux (Ubuntu)**: работает как обычный python‑скрипт, можно собирать AppImage.

---

## Быстрый старт (для пользователей)

### Windows (portable .exe)
1. Скачайте `JDS6600Controller.exe`.
2. Подключите генератор по USB.
3. Запустите `.exe`.
4. Нажмите **Авто‑поиск** (или выберите порт вручную) — в статусе должно стать **«устройство найдено»**.
5. Нажмите **Старт**.

Если устройство не находится:
- подождите 5–10 секунд после подключения (Windows ставит драйвер),
- переподключите USB,
- перезагрузите ПК,
- при необходимости установите драйвер с диска.

### Ubuntu / Linux (из исходников)
Требуется `python3-tk` (GUI) и права на сериал‑порт.

```bash
sudo apt update
sudo apt install -y python3-tk
python3 run_gui.py
```

> Если видите “Permission denied” на `/dev/ttyUSB0` — добавьте пользователя в группу `dialout`:
> `sudo usermod -aG dialout $USER` и перелогиньтесь.

---

## Установка для разработки (Python)

```bash
python -m venv .venv
# Linux
source .venv/bin/activate
# Windows (PowerShell)
# .\.venv\Scripts\Activate.ps1

pip install -r requirements.txt
```

---

## Формат файла команд (CSV)

Файл — обычный текстовый `.csv`. Строки‑команды:

### 1) `freq`
```
freq,<Hz>[,<опциональные настройки>]
```

Пример:
```csv
freq,1000,{"channel":"1+2","waveform":"sine","amplitude":1.0}
```

### 2) `wait`
```
wait,<секунды>
```

Пример:
```csv
wait,2.5
```

### 3) `stop`
```
stop
```
Выключает оба канала (outputs off). **Команда поддерживается**, но в шаблонных файлах по умолчанию не вставляется.

### 4) Циклы частот

#### Вариант A (рекомендуется): `cycle`
```
cycle,[Hz1,Hz2,...],on=<сек>,off=<сек>[,<опциональные настройки>]
```

Смысл: для каждой частоты из списка
1) поставить частоту, подождать `on`  
2) поставить **0 Hz**, подождать `off`  
3) перейти к следующей частоте

Пример:
```csv
cycle,[1000,2000,3000],on=5,off=10,{"channel":"1+2","waveform":"sine","amplitude":1.0}
```

Также поддерживается позиционный вид:
```csv
cycle,[1000,2000,3000],5,10,{"channel":"1+2"}
```

#### Вариант B (совместимость): “старый” цикл через `freq + wait + freq,0 + wait`
```csv
freq,[1000,2000,3000],{"channel":"1+2"}
wait,5
freq,0
wait,10
```

---

## Настройки (JSON) и каналы

Третий параметр у `freq`/`cycle` — объект настроек. **Рекомендуется строгий JSON** (двойные кавычки, без лишних запятых):
```json
{"waveform":"sine","amplitude":1.0,"offset":0.8,"dutycycle":30}
```

Для удобства допускается и сокращённый “квазии‑JSON” (лучше всё же писать строгий):
```
{channel:"1+2",waveform:sine,amplitude:1.0}
```

Выбор канала:
- `"channel":"1+2"` (или `"both"`) — оба канала
- `"channel":1` — только канал 1
- `"channel":2` — только канал 2

Можно задавать отдельные параметры для каналов:
```json
{"ch1":{"frequency":1000,"amplitude":1.0},"ch2":{"frequency":1500,"amplitude":1.0,"offset":0.2}}
```

Включение/выключение выходов:
```json
{"channels":{"channel1":true,"channel2":false}}
```

---

## Важное про CSV и разделители

- Программа **авто‑определяет разделитель**: запятая `,`, точка‑с‑запятой `;` или таб `\t`.
- Внутри настроек используется JSON со своими запятыми — это нормально.
- Если вы редактируете файл в Excel/LibreOffice и он “ломает” строку, попробуйте:
  - сохранять как **CSV с разделителем `;`**, или
  - редактировать файл во встроенном редакторе программы.

---

## GUI: кнопки и полезные функции

- **Обновить** — перечитать список портов
- **Авто‑поиск** — найти устройство и выбрать “самый надёжный” порт (на Linux предпочитает `/dev/serial/by-id/...`)
- **Проверить CSV** — проверить файл на ошибки без запуска
- **Старт / Пауза / Стоп**
- **Следующая команда** — пропускает текущий `wait`
- **Фиксированный wait** — если включено, заменяет длительность всех `wait` во время выполнения
- Редактор поддерживает:
  - подсветку текущей строки,
  - **контекстное меню** (ПКМ: копировать/вставить/вырезать/выделить всё),
  - Ctrl+C / Ctrl+V работает даже при русской раскладке (Windows).

---

## CLI

```bash
python3 run_cli.py --list-ports
python3 run_cli.py --file commands.csv
python3 run_cli.py --port /dev/ttyUSB0 --file commands.csv
```

---

## Сборка

### Windows (.exe)
```powershell
powershell -ExecutionPolicy Bypass -File packaging\windows\build_windows.ps1
```
Результат: `dist\JDS6600Controller.exe`

### Linux (AppImage)
```bash
./packaging/linux/build_appimage.sh
```

---

## Ссылки
- Telegram разработчика: https://t.me/JcJet (@JcJet)
